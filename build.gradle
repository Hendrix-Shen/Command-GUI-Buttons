plugins {
    id("maven-publish")
    id("fabric-loom").version("1.0-SNAPSHOT").apply(false)
    // https://github.com/ReplayMod/preprocessor
    // https://github.com/Fallen-Breath/preprocessor
    id("com.replaymod.preprocess").version("897c4096e2")
    id("org.ajoberstar.grgit").version("5.0.0")
}

preprocess {
    def mc1193 = createNode("1.19.3", 1_19_03, "mojang")
}

def ENV = System.getenv()
String realVersion = "${project.mod_version}"
realVersion += "." + (ENV.BUILD_NUMBER ? "${ENV.BUILD_NUMBER}" : "${new Date().format("yyyyMMdd.HHmmss")}")
realVersion += (grgit.status().clean ? "+" : ".dirty.")
realVersion += grgit.head().abbreviatedId

version(realVersion)